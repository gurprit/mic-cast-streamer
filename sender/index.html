<!DOCTYPE html>
<html>
<head>
  <title>Mic Sender (WebM)</title>
</head>
<body>
  <h1>Mic Sender</h1>
  <button id="startBtn">Start Streaming</button>

  <script>
    let ws;

    document.getElementById("startBtn").addEventListener("click", () => {
      navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
        ws = new WebSocket("wss://mic-cast-streamer.onrender.com");
        ws.binaryType = "arraybuffer";

        const mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0 && ws.readyState === WebSocket.OPEN) {
            e.data.arrayBuffer().then(buffer => {
              ws.send(buffer);
            });
          }
        };

        mediaRecorder.start(250); // Send chunk every 250ms
      });
    });
  </script>
</body>
</html>
